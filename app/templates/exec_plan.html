{% extends "skeleton.html" %}

{% import "_macros.html" as macros %}

{% block page_only_styles %}
<link href="{{ url_for('static', filename='vendor/bootstrap-touchspin/jquery.bootstrap-touchspin.min.css') }}" rel="stylesheet" media="screen">
<link href="{{ url_for('static', filename='vendor/select2/select2.min.css') }}" rel="stylesheet" media="screen">
<link href="{{ url_for('static', filename='vendor/bootstrap-datepicker/bootstrap-datepicker3.standalone.min.css') }}" rel="stylesheet" media="screen">
<link href="{{ url_for('static', filename='vendor/bootstrap-timepicker/bootstrap-timepicker.min.css') }}" rel="stylesheet" media="screen">
{% endblock %}

{% block page_main_title %}Execution Plan{% endblock %}

{% block page_main_desc %}Execution plan for all interface data fetching.{% endblock page_main_desc %}

{% block page_content %}
<div class="container-fluid container-fullw bg-white">
    <div class="row">
        <div class="col-md-12">
            <!-- start: LARGE MODAL -->
            <div class="modal fade bs-example-modal-lg"  tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                            <h4 class="modal-title" id="myModalLabel">Modal title</h4>
                        </div>
                        <div class="modal-body">
                            Modal Content
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-primary btn-o" data-dismiss="modal">
                                Close
                            </button>
                            <button type="button" class="btn btn-primary">
                                Save changes
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- end: LARGE MODAL -->
            <!-- start: QUERY CONDITION -->
            <form method="POST" action="{{ url_for('main.execplan') }}">
                {{ form.hidden_tag() }}
                <div class="panel panel-white" id="panel1">
                    <div class="panel-heading">
                        <h4 class="panel-title text-primary">Query Condition</h4>
                        <ul class="panel-heading-tabs border-light">
                            <li>
                                <div class="pull-right">
                                    <div class="form-actions">
                                        <button type="submit" class="btn btn-azure">
                                            Query
                                        </button>
                                    </div>
                                </div>
                            </li>
                            <li class="panel-tools">
                                <a data-original-title="Collapse" data-toggle="tooltip" data-placement="top" class="btn btn-transparent btn-sm panel-collapse" href="#"><i class="ti-minus collapse-off"></i><i class="ti-plus collapse-on"></i></a>
                            </li>
                        </ul>
                    </div>
                    <div class="panel-body">
                        <div class="row">
                            <div class="col-sm-6">
                                {{ macros.errors_widget(form.qcd_exectime_start) }}
                                <div class="form-group">
                                    <div class="checkbox clip-check check-primary">
                                        {{ form.qcc_exectime(disabled="disabled") }}
                                        <label for="{{ form.qcc_exectime.id }}">
                                            Execution Time
                                        </label>
                                    </div>
                                    <div class="input-group input-daterange datepicker">
                                        {{ form.qcd_exectime_start(class_="form-control") }}
                                        <span class="input-group-addon bg-primary">to</span>
                                        {{ form.qcd_exectime_end(class_="form-control") }}
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                {{ macros.errors_widget(form.qcd_biztypes) }}
                                <div class="form-group">
                                    <div class="checkbox clip-check check-primary">
                                        <!--<input type="checkbox" id="qcc-biztypes" value="1" />-->
                                        {{ form.qcc_biztypes() }}
                                        <label for="{{ form.qcc_biztypes.id }}">
                                            Business Types -- {{ qcc_biztypes }}
                                        </label>
                                    </div>
                                    {{ form.qcd_biztypes(class_="js-example-basic-multiple js-states form-control") }}
                                    <!--<select id="qcd-biztypes" multiple="" class="js-example-basic-multiple js-states form-control">-->
                                        <!--<optgroup label="Processed">-->
                                            <!--<option value="PRF">refund</option>-->
                                            <!--<option value="PIV">inventory</option>-->
                                            <!--<option value="PSF">shifting</option>-->
                                            <!--<option value="PSI">stockin</option>-->
                                            <!--<option value="PSO">stockout</option>-->
                                            <!--<option value="PTR">trade</option>-->
                                        <!--</optgroup>-->
                                        <!--<optgroup label="Finished">-->
                                            <!--<option value="FRF">refund_finished</option>-->
                                            <!--<option value="FTR">trade_finished</option>-->
                                        <!--</optgroup>-->
                                    <!--</select>-->
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    {{ form.qcd_handled() }}
                                    <!--<div class="radio clip-radio radio-primary radio-inline">-->
                                        <!--<input type="radio" id="radio1" name="inline" value="radio1">-->
                                        <!--<label for="radio1">-->
                                            <!--Radio 1-->
                                        <!--</label>-->
                                    <!--</div>-->
                                    <!--<div class="radio clip-radio radio-primary radio-inline">-->
                                        <!--<input type="radio" id="radio2" name="inline" value="radio2" checked="checked">-->
                                        <!--<label for="radio2">-->
                                            <!--Radio 2-->
                                        <!--</label>-->
                                    <!--</div>-->
                                    <!--<div class="checkbox clip-check check-primary">-->
                                        <!--&lt;!&ndash;<input type="checkbox" id="qcc-handled" value="1" />&ndash;&gt;-->
                                        <!--{#{{ form.qcc_handled() }}#}-->
                                        <!--{#<label for="{{ form.qcc_handled.id }}">#}-->
                                            <!--Handled-->
                                        <!--</label>-->
                                    <!--</div>-->
                                    <!--<div class="checkbox">-->
                                        <!--<input type="checkbox" id="qcd-handled" checked />-->
                                        <!--{#{{ form.qcd_handled(class_="js-switch") }}#}-->
                                    <!--</div>-->
                                    <!--<div class="btn-group" data-toggle="buttons">-->
                                        <!--{#{{ form.qcd_all() }}#}-->
                                        <!--<label class="btn btn-primary active">-->
                                            <!--<input type="radio" name="options" id="option1" autocomplete="off" checked>-->
                                            <!--Left-->
                                        <!--</label>-->
                                        <!--<label class="btn btn-primary">-->
                                            <!--<input type="radio" name="options" id="option2" autocomplete="off">-->
                                            <!--Middle-->
                                        <!--</label>-->
                                        <!--<label class="btn btn-primary">-->
                                            <!--<input type="radio" name="options" id="option3" autocomplete="off">-->
                                            <!--Right-->
                                        <!--</label>-->
                                    <!--</div>-->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
            <!-- end: QUERY CONDITION -->
            <!-- start: DATA TABLE -->
            <table class="table table-striped table-bordered table-hover table-full-width" id="sample_1">
                <thead>
                    <tr>
                        <th class="center">#</th>
                        <th>Type</th>
                        <th class="hidden-xs">Execute Time</th>
                        <th>Handled</th>
                        <th class="hidden-xs">Start Time</th>
                        <th class="hidden-xs">End time</th>
                        <th>Number of Entries</th>
                        <th class="hidden-xs">Detail</th>
                    </tr>
                </thead>
                <tbody>
                    {% for plan in exec_plans %}
                        <tr{% if not plan.handle_flag %} class="danger"{% endif %}>
                            <th class="center" scope="row">{{ (pagination.page - 1) * AppConfig["WEBWDT_DATA_PER_PAGE"] + loop.index }}</td>
                            <td>{{ plan.type }}</td>
                            <td class="hidden-xs">{{ plan.exec_time }}</td>
                            <td class="center">{{ plan.handle_flag }}</td>
                            <td class="hidden-xs">{{ plan.params.start_time }}</td>
                            <td class="hidden-xs">{{ plan.params.end_time }}</td>
                            <td class="hidden-xs">{{ plan.params.page_size }}</td>
                            <td class="center">
                                <div class="visible-md visible-lg hidden-sm hidden-xs">
                                    <a href="#" class="btn btn-transparent btn-xs" tooltip-placement="top" \
                                       tooltip="More" data-toggle="modal" data-target=".bs-example-modal-lg"><i class="fa fa-ellipsis-h"></i></a>
                                </div>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
            <!-- end: DATA TABLE -->
            <!-- start: PAGINATION -->
            <div>
                {{ macros.pagination_widget(
                            pagination, "main.execplan", fragment="",
                            qcc_exectime=qcc_exectime,
                            start_time=start_time,
                            end_time=end_time,
                            qcc_biztypes=qcc_biztypes,
                            biz_types=biz_types,
                            handled=handled,
                ) }}
            </div>
            <!-- end: PAGINATION -->
        </div>
    </div>
</div>
{% endblock page_content %}

{% block page_only_scripts %}
<script src="{{ url_for('static', filename='vendor/maskedinput/jquery.maskedinput.min.js') }}"></script>
<script src="{{ url_for('static', filename='vendor/bootstrap-touchspin/jquery.bootstrap-touchspin.min.js') }}"></script>
<script src="{{ url_for('static', filename='vendor/autosize/autosize.min.js') }}"></script>
<script src="{{ url_for('static', filename='vendor/selectFx/classie.js') }}"></script>
<script src="{{ url_for('static', filename='vendor/selectFx/selectFx.js') }}"></script>
<script src="{{ url_for('static', filename='vendor/select2/select2.min.js') }}"></script>
<script src="{{ url_for('static', filename='vendor/bootstrap-datepicker/bootstrap-datepicker.min.js') }}"></script>
<script src="{{ url_for('static', filename='vendor/bootstrap-timepicker/bootstrap-timepicker.min.js') }}"></script>
{% endblock %}

{% block page_event_handle_scripts %}
<script src="{{ url_for('static', filename='assets/js/form-elements.js') }}"></script>
<script>
    $(function() {
        $("#qcc-exectime").change(function() {
            if ($("#qcc-exectime").prop('checked')) {
                $("#qcd-exectime-start").removeAttr("disabled");
                $("#qcd-exectime-end").removeAttr("disabled");
            }
            else {
                $("#qcd-exectime-start").attr("disabled","disabled");
                $("#qcd-exectime-end").attr("disabled","disabled");
            }
        });

        $("#qcc-biztypes").change(function() {
            if ($("#qcc-biztypes").prop('checked')) {
                $("#qcd-biztypes").removeAttr("disabled");
            }
            else {
                $("#qcd-biztypes").attr("disabled","disabled");
            }
        });

        $("#qcc-handled").change(function() {
            if ($("#qcc-handled").prop('checked')) {
    //            $("#qcd-handled").removeAttr("disabled");
                $("#qcd-handled").attr('disabled',false);//按钮可用
            }
            else {
    //            $("#qcd-handled").attr("disabled","disabled");
                $("#qcd-handled").attr('disabled',true);//按钮不可用
            }
        });
    });

    jQuery(document).ready(function() {
        Main.init();
        FormElements.init();
    });
</script>
{% endblock %}